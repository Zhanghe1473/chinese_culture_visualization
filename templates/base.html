<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}华夏瑰宝-文化科学可视化展示系统{% endblock %}</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/additional.css') }}">
    {% block extra_css %}{% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% block extra_js_head %}{% endblock %}
</head>
<body>
    <!-- 加载动画 -->
    {% include 'components/loader.html' %}

    <!-- 移动设备菜单按钮 -->
    <div class="menu-toggle">
        <i class="fa fa-bars"></i>
    </div>

    <!-- 头部 -->
    {% include 'components/header.html' %}

    <!-- 导航栏 -->
    {% include 'components/navigation.html' %}

    <!-- 主内容区域 -->
    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- 页脚 -->
    {% include 'components/footer.html' %}

    <!-- 装饰元素 -->
    <div class="decoration decoration-top-right"></div>
    <div class="decoration decoration-bottom-left"></div>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="back-to-top-btn">
        <i class="fa fa-arrow-up"></i>
    </button>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/module_loader.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
<!-- 在base.html中添加这段代码来检测静态文件加载状态 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 检查样式是否加载成功
        function isStyleLoaded(href) {
            for (let i = 0; i < document.styleSheets.length; i++) {
                if (document.styleSheets[i].href && document.styleSheets[i].href.indexOf(href) !== -1) {
                    return true;
                }
            }
            return false;
        }

        // 检查各个CSS文件
        console.log('style.css 加载状态:', isStyleLoaded('style.css'));
        console.log('additional.css 加载状态:', isStyleLoaded('additional.css'));

        // 检查各个JS文件
        console.log('main.js 加载状态:', typeof initializeCharts !== 'undefined');
        console.log('module_loader.js 加载状态:', typeof loadModule !== 'undefined');
        console.log('ECharts 加载状态:', typeof echarts !== 'undefined');
        console.log('Chart.js 加载状态:', typeof Chart !== 'undefined');
    });
</script>
<!-- 在body底部添加这个调试工具，在开发时使用 -->
<div id="debug-panel" style="position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.7); color: white; padding: 10px; font-size: 12px; max-width: 300px; max-height: 200px; overflow: auto; z-index: 9999; display: none;">
    <h4>调试面板</h4>
    <div id="debug-content"></div>
    <button onclick="document.getElementById('debug-panel').style.display='none'">关闭</button>
</div>

<script>
// 调试工具
function debugLog(message) {
    const debugContent = document.getElementById('debug-content');
    if(debugContent) {
        debugContent.innerHTML += `<div>${message}</div>`;
        document.getElementById('debug-panel').style.display = 'block';
    }
    console.log(message);
}

// 按键组合Ctrl+Shift+D显示调试面板
document.addEventListener('keydown', function(event) {
    if(event.ctrlKey && event.shiftKey && event.key === 'D') {
        const debugPanel = document.getElementById('debug-panel');
        debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';

        // 检查关键资源加载状态
        checkResourceLoading();
    }
});

// 检查资源加载
function checkResourceLoading() {
    // 检查CSS
    for(let i=0; i<document.styleSheets.length; i++) {
        try {
            let sheet = document.styleSheets[i];
            debugLog(`CSS加载: ${sheet.href || '内联样式'}`);
        } catch(e) {
            debugLog(`CSS加载错误: ${e.message}`);
        }
    }

    // 检查JS变量
    debugLog(`main.js: ${typeof initializeCharts !== 'undefined' ? '已加载' : '未加载'}`);
    debugLog(`module_loader.js: ${typeof loadModule !== 'undefined' ? '已加载' : '未加载'}`);

    // 显示当前活动模块
    const activeItems = document.querySelectorAll('.nav-item.active');
    activeItems.forEach(item => {
        debugLog(`当前活动模块: ${item.getAttribute('data-module') || '无'}`);
    });
}
</script>